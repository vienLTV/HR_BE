<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
    https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
    http://www.liquibase.org/xml/ns/dbchangelog
    https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="f2230160-cc84-4ca2-a591-05c09157e3b6" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="employee_core" />
            </not>
        </preConditions>
        <createTable tableName="employee_core">
            <column name="employee_id" type="UUID">
                <constraints primaryKey="true"/>
            </column>
            <column name="account_email" type="NVARCHAR(100)">
                <constraints unique="true"/>
            </column>
            <column name="company_email" type="NVARCHAR(255)"/>
            <column name="company_phone_number" type="NVARCHAR(20)"/>
            <column name="employee_code" type="NVARCHAR(20)"/>
            <column name="employee_status" type="NVARCHAR(50)"/>
            <column name="job_title_id" type="UUID" />
            <column name="team_id" type="UUID" />
            <column name="organization_id" type="UUID">
                <constraints nullable="false" />
            </column>

            <column name="first_name" type="NVARCHAR(100)"/>
            <column name="last_name" type="NVARCHAR(100)"/>
            <column name="personal_email" type="NVARCHAR(255)"/>
            <column name="personal_phone_number" type="NVARCHAR(20)"/>
            <column name="date_of_birth" type="DATE"/>
            <column name="current_address" type="NVARCHAR(255)"/>
            <column name="birth_place" type="NVARCHAR(255)"/>
            <column name="marital_status" type="NVARCHAR(50)"/>
            <column name="gender" type="NVARCHAR(20)"/>
        </createTable>
    </changeSet>

    <changeSet id="f2230160-cc84-4ca2-a591-05c09157e321" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="job_title" />
            </not>
        </preConditions>
        <createTable tableName="job_title">
            <column name="job_title_id" type="UUID">
                <constraints primaryKey="true"/>
            </column>
            <column name="title" type="NVARCHAR(255)"/>
            <column name="description" type="NVARCHAR(1000)"/>
        </createTable>
    </changeSet>

    <changeSet id="5e26ba3f-8391-4be0-adb5-a5328a251345" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="users" />
            </not>
        </preConditions>
        <createTable tableName="users">
            <column name="account_email" type="NVARCHAR(100)">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="password" type="NVARCHAR(64)">
                <constraints nullable="false" />
            </column>
            <column name="account_status" type="NVARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="organization_id" type="UUID">
                <constraints nullable="false" />
            </column>
            <column name="employee_id" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="833a66e0-5d0a-499a-a5ec-af0fc651582b" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="users_roles" />
            </not>
        </preConditions>
        <createTable tableName="users_roles">
            <column name="user_role_id" type="UUID">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="account_email" type="NVARCHAR(100)">
                <constraints nullable="false" />
            </column>
            <column name="role_name" type="NVARCHAR(100)">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2b6be3ff-1c5f-4c84-8348-cb58211e046b" author="duy_nguyen">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="certificate" />
            </not>
        </preConditions>
        <createTable tableName="certificate">
            <column name="certificate_id" type="UUID">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="certificate_name" type="NVARCHAR(255)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="NVARCHAR(500)"/>
            <column name="provider" type="NVARCHAR(500)">
                <constraints nullable="false" />
            </column>
            <column name="level" type="NVARCHAR(100)"/>
            <column name="license_code" type="NVARCHAR(255)"/>
            <column name="issued_date" type="DATE"/>
            <column name="expired_date" type="DATE"/>
            <column name="certificate_img" type="NVARCHAR(500)"/>
            <column name="employee_id" type="UUID">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="678ad078-7dca-474f-a9ee-be9306b71130" author="duy_nguyen">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="bank_account" />
            </not>
        </preConditions>
        <createTable tableName="bank_account">
            <column name="bank_account_id" type="UUID">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="account_holder_name" type="NVARCHAR(255)">
                <constraints nullable="false" />
            </column>
            <column name="account_number" type="NVARCHAR(50)">
                <constraints nullable="false" />
            </column>
            <column name="bank_name" type="NVARCHAR(255)">
                <constraints nullable="false" />
            </column>
            <column name="issued_date" type="DATE">
                <constraints nullable="false" />
            </column>
            <column name="expired_date" type="DATE"/>
            <column name="expiry_status" type="NVARCHAR(50)"/>
            <column name="employee_id" type="UUID">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="78eadc95-63f3-4056-b57e-d9d1de863726" author="duy_nguyen">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="department"/>
            </not>
        </preConditions>
        <createTable tableName="department">
            <column name="department_id" type="UUID">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="department_name" type="NVARCHAR(255)">
                <constraints nullable="false" />
            </column>
            <column name="department_code" type="NVARCHAR(255)"/>
            <column name="description" type="NVARCHAR(1000)"/>
            <column name="manager_id" type="UUID"/>
            <column name="location" type="NVARCHAR(255)"/>
            <column name="established_date" type="DATE"/>
            <column name="phone_number" type="NVARCHAR(20)"/>
            <column name="email" type="NVARCHAR(100)"/>
            <column name="parent_id" type="UUID"/>
        </createTable>
    </changeSet>

    <changeSet id="78eadc95-63f3-4056-b57e-d32cde863726" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="team"/>
            </not>
        </preConditions>
        <createTable tableName="team">
            <column name="team_id" type="UUID">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="NVARCHAR(255)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="NVARCHAR(1000)"/>
            <column name="department_id" type="UUID"/>
            <column name="established_date" type="DATE"/>
            <column name="phone_number" type="NVARCHAR(20)"/>
            <column name="email" type="NVARCHAR(100)"/>
            <column name="location" type="NVARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet id="78eadc95-63f3-4056-b57e-d32cde863das" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="team_member"/>
            </not>
        </preConditions>
        <createTable tableName="team_member">
            <column name="employee_id" type="UUID">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="team_id" type="UUID">
                <constraints nullable="false" />
            </column>
            <column name="team_role" type="NVARCHAR(50)"/>
        </createTable>
    </changeSet>

    <changeSet id="78eadc95-1231-4056-b57e-d32cde863das" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="employee_job_title"/>
            </not>
        </preConditions>
        <createTable tableName="employee_job_title">
            <column name="employee_id" type="UUID">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="job_id" type="UUID">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="f2230160-cc84-4daq-1121-32131257e3b6" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="employee_profile" />
            </not>
        </preConditions>
        <createTable tableName="employee_profile">
            <column name="employee_id" type="UUID">
                <constraints primaryKey="true"/>
            </column>
            <column name="avatar_image" type="BLOB"/>
            <column name="avatar_file_name" type="VARCHAR(255)"/>
            <column name="avatar_content_type" type="VARCHAR(100)"/>
            <column name="avatar_file_size" type="BIGINT"/>
        </createTable>
    </changeSet>

    <changeSet id="f2230160-cc84-4daq-31aq-32131257e3b6" author="khanh_tran">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="organization" />
            </not>
        </preConditions>
        <createTable tableName="organization">
            <column name="organization_id" type="UUID">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(100)"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="created_at" type="DATE"/>
            <column name="owner_account" type="VARCHAR(100)"/>
        </createTable>
    </changeSet>

    <changeSet id="319b5e43-8356-4e53-844e-2c0e51b49464" author="duy_nguyen">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="employee_history"/>
            </not>
        </preConditions>
        <createTable tableName="employee_history">
            <column name="employee_history_id" type="UUID">
                <constraints primaryKey="true"/>
            </column>
            <column name="employee_id" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="company_name" type="NVARCHAR(255)"/>
            <column name="employment_type" type="NVARCHAR(100)"/>
            <column name="job_title" type="NVARCHAR(100)"/>
            <column name="start_date" type="DATE"/>
            <column name="end_date" type="DATE"/>
            <column name="company_address" type="NVARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet id="c6a92047-a596-4916-b3ac-edafde6ad2b2" author="duy_nguyen">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="emergency_contact"/>
            </not>
        </preConditions>
        <createTable tableName="emergency_contact">
            <column name="emergency_contact_id" type="UUID">
                <constraints primaryKey="true"/>
            </column>
            <column name="employee_id" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="contact_name" type="NVARCHAR(100)"/>
            <column name="relationship" type="NVARCHAR(100)"/>
            <column name="daytime_number" type="NVARCHAR(20)"/>
            <column name="after_hours_number" type="NVARCHAR(20)"/>
            <column name="contact_type" type="NVARCHAR(100)"/>
            <column name="address" type="NVARCHAR(255)"/>
        </createTable>
    </changeSet>

    <changeSet id="a7b83058-b697-5027-c4bd-feafef7be3c3" author="attendance_module">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="attendance"/>
            </not>
        </preConditions>
        <createTable tableName="attendance">
            <column name="attendance_id" type="UUID">
                <constraints primaryKey="true"/>
            </column>
            <column name="organization_id" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="employee_id" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="attendance_date" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="check_in_time" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="check_out_time" type="TIMESTAMP"/>
            <column name="status" type="NVARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="notes" type="TEXT"/>
        </createTable>
    </changeSet>

    <changeSet id="a7b83058-b697-5027-c4bd-feafef7be3c4" author="attendance_module">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="idx_attendance_org_emp_date"/>
            </not>
        </preConditions>
        <addUniqueConstraint tableName="attendance"
                             constraintName="uk_attendance_org_emp_date"
                             columnNames="organization_id,employee_id,attendance_date"/>
    </changeSet>

    <changeSet id="a7b83058-b697-5027-c4bd-feafef7be3c5" author="attendance_module">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="idx_attendance_organization_id"/>
            </not>
        </preConditions>
        <createIndex tableName="attendance" indexName="idx_attendance_organization_id">
            <column name="organization_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="a7b83058-b697-5027-c4bd-feafef7be3c6" author="attendance_module">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="idx_attendance_employee_id"/>
            </not>
        </preConditions>
        <createIndex tableName="attendance" indexName="idx_attendance_employee_id">
            <column name="employee_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="a7b83058-b697-5027-c4bd-feafef7be3c7" author="attendance_module">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists indexName="idx_attendance_date"/>
            </not>
        </preConditions>
        <createIndex tableName="attendance" indexName="idx_attendance_date">
            <column name="attendance_date"/>
        </createIndex>
    </changeSet>

</databaseChangeLog>
